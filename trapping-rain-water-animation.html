<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥é›¨æ°´ - åŠ¨ç”»æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 5px;
            font-size: 1.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
            font-size: 0.85em;
        }

        .input-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }

        input:focus {
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-info {
            background: #4299e1;
            color: white;
        }

        .btn-info:hover {
            background: #3182ce;
        }

        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .controls button {
            padding: 10px 20px;
            font-size: 14px;
        }

        .main-content {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .left-panel {
            flex: 0 0 300px;
        }

        .right-panel {
            flex: 1;
        }

        .info-panel {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #4a5568;
        }

        .info-value {
            color: #2d3748;
            font-family: 'Courier New', monospace;
        }

        .canvas-container {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            overflow-x: auto;
        }

        #canvas {
            display: block;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .speed-control label {
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }

        .speed-control input {
            flex: 0 0 120px;
        }

        .speed-control span {
            font-size: 14px;
            color: #4a5568;
        }

        .formula {
            background: #edf2f7;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: center;
            color: #2d3748;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            .left-panel {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’§ æ¥é›¨æ°´ - åŠ¨ç”»æ¼”ç¤º</h1>
        <p class="subtitle">Trapping Rain Water - å¯è§†åŒ–å­¦ä¹ </p>

        <div class="input-section">
            <input type="text" id="heightInput" placeholder="è¾“å…¥æ•°ç»„ï¼Œä¾‹å¦‚: 0,1,0,2,1,0,1,3,2,1,2,1" value="0,1,0,2,1,0,1,3,2,1,2,1">
            <button class="btn-primary" onclick="initAnimation()">å¼€å§‹åŠ¨ç”»</button>
            <button class="btn-secondary" onclick="loadExample()">åŠ è½½ç¤ºä¾‹</button>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="playPause()" id="playBtn">â–¶ æ’­æ”¾</button>
            <button class="btn-info" onclick="stepForward()">â­ å•æ­¥</button>
            <button class="btn-danger" onclick="reset()">ğŸ”„ é‡ç½®</button>
        </div>

        <div class="main-content">
            <div class="left-panel">

                <div class="info-panel">
                    <div class="info-item">
                        <span class="info-label">å½“å‰ä½ç½® (i):</span>
                        <span class="info-value" id="currentIndex">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å½“å‰é«˜åº¦:</span>
                        <span class="info-value" id="currentHeight">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å·¦è¾¹æœ€é«˜:</span>
                        <span class="info-value" id="leftMax">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">å³è¾¹æœ€é«˜:</span>
                        <span class="info-value" id="rightMax">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ°´ä½:</span>
                        <span class="info-value" id="waterLevel">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">èƒ½æ¥çš„æ°´:</span>
                        <span class="info-value" id="waterAmount">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ€»æ¥æ°´é‡:</span>
                        <span class="info-value" id="totalWater">0</span>
                    </div>
                </div>

                <div class="formula">
                    <strong>å…¬å¼ï¼š</strong><br>
                    èƒ½æ¥çš„æ°´ = max(0, min(å·¦è¾¹æœ€é«˜, å³è¾¹æœ€é«˜) - å½“å‰é«˜åº¦)
                </div>
            </div>

            <div class="right-panel">
                <div class="canvas-container">
                    <canvas id="canvas" width="900" height="450"></canvas>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #4299e1;"></div>
                <span>æŸ±å­</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #48bb78;"></div>
                <span>å½“å‰å¤„ç†çš„ä½ç½®</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f6e05e;"></div>
                <span>å·¦è¾¹æœ€é«˜æŸ±å­</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fc8181;"></div>
                <span>å³è¾¹æœ€é«˜æŸ±å­</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #90cdf4; opacity: 0.6;"></div>
                <span>èƒ½æ¥çš„æ°´</span>
            </div>
        </div>
    </div>

    <script>
        let height = [];
        let currentStep = 0;
        let isPlaying = false;
        let animationTimer = null;
        let speed = 800;
        let totalWater = 0;
        let steps = [];

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function loadExample() {
            document.getElementById('heightInput').value = '0,1,0,2,1,0,1,3,2,1,2,1';
            initAnimation();
        }

        function initAnimation() {
            const input = document.getElementById('heightInput').value;
            height = input.split(',').map(h => parseInt(h.trim())).filter(h => !isNaN(h));
            
            if (height.length === 0) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°ç»„ï¼');
                return;
            }

            reset();
            calculateSteps();
            draw();
            updateInfo();
        }

        function calculateSteps() {
            steps = [];
            const n = height.length;
            
            // é¢„å¤„ç†å·¦å³æœ€å¤§å€¼
            const leftMax = new Array(n);
            const rightMax = new Array(n);
            
            leftMax[0] = height[0];
            for (let i = 1; i < n; i++) {
                leftMax[i] = Math.max(leftMax[i - 1], height[i]);
            }
            
            rightMax[n - 1] = height[n - 1];
            for (let i = n - 2; i >= 0; i--) {
                rightMax[i] = Math.max(rightMax[i + 1], height[i]);
            }

            // è®¡ç®—æ¯ä¸ªä½ç½®
            for (let i = 0; i < n; i++) {
                const leftMaxValue = i > 0 ? Math.max(...height.slice(0, i)) : 0;
                const rightMaxValue = i < n - 1 ? Math.max(...height.slice(i + 1)) : 0;
                const waterLevel = Math.min(leftMaxValue, rightMaxValue);
                const waterAmount = Math.max(0, waterLevel - height[i]);
                
                steps.push({
                    index: i,
                    height: height[i],
                    leftMax: leftMaxValue,
                    rightMax: rightMaxValue,
                    waterLevel: waterLevel,
                    waterAmount: waterAmount,
                    leftMaxIndex: height.slice(0, i).lastIndexOf(leftMaxValue),
                    rightMaxIndex: i < n - 1 ? i + 1 + height.slice(i + 1).indexOf(rightMaxValue) : -1
                });
            }
        }

        function draw() {
            const n = height.length;
            const barWidth = Math.min(50, (canvas.width - 80) / n);
            const maxHeight = Math.max(...height, 5);
            const scale = (canvas.height - 150) / maxHeight;
            const startX = 50;
            const startY = canvas.height - 50;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶ç½‘æ ¼çº¿
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= maxHeight; i++) {
                const y = startY - i * scale;
                ctx.beginPath();
                ctx.moveTo(startX, y);
                ctx.lineTo(startX + n * barWidth, y);
                ctx.stroke();
            }

            // ç»˜åˆ¶å½“å‰æ­¥éª¤çš„ä¿¡æ¯
            if (currentStep < steps.length) {
                const step = steps[currentStep];
                
                // å…ˆç»˜åˆ¶æ‰€æœ‰æŸ±å­
                for (let i = 0; i < n; i++) {
                    const x = startX + i * barWidth;
                    const h = height[i] * scale;
                    
                    // å½“å‰å¤„ç†çš„ä½ç½®
                    if (i === step.index) {
                        ctx.fillStyle = '#48bb78';
                    } else {
                        ctx.fillStyle = '#4299e1';
                    }
                    
                    ctx.fillRect(x, startY - h, barWidth - 2, h);
                    
                    // ç»˜åˆ¶é«˜åº¦æ ‡ç­¾
                    ctx.fillStyle = '#2d3748';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(height[i], x + barWidth / 2, startY + 20);
                }

                // ç»˜åˆ¶å·¦è¾¹æœ€é«˜æŸ±å­
                if (step.leftMaxIndex >= 0) {
                    const x = startX + step.leftMaxIndex * barWidth;
                    ctx.strokeStyle = '#f6e05e';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x, startY - height[step.leftMaxIndex] * scale, barWidth - 2, height[step.leftMaxIndex] * scale);
                }

                // ç»˜åˆ¶å³è¾¹æœ€é«˜æŸ±å­
                if (step.rightMaxIndex >= 0 && step.rightMaxIndex < n) {
                    const x = startX + step.rightMaxIndex * barWidth;
                    ctx.strokeStyle = '#fc8181';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(x, startY - height[step.rightMaxIndex] * scale, barWidth - 2, height[step.rightMaxIndex] * scale);
                }

                // ç»˜åˆ¶æ°´ä½çº¿
                if (step.waterLevel > 0) {
                    const waterY = startY - step.waterLevel * scale;
                    ctx.strokeStyle = '#4299e1';
                    ctx.lineWidth = 2;
                    ctx.setLineDash([5, 5]);
                    ctx.beginPath();
                    ctx.moveTo(startX, waterY);
                    ctx.lineTo(startX + n * barWidth, waterY);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // æ°´ä½æ ‡ç­¾
                    ctx.fillStyle = '#4299e1';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`æ°´ä½: ${step.waterLevel}`, startX + n * barWidth + 10, waterY);
                }

                // ç»˜åˆ¶èƒ½æ¥çš„æ°´
                if (step.waterAmount > 0) {
                    const x = startX + step.index * barWidth;
                    const waterH = step.waterAmount * scale;
                    ctx.fillStyle = 'rgba(144, 205, 244, 0.6)';
                    ctx.fillRect(x, startY - step.waterLevel * scale, barWidth - 2, waterH);
                }

                // ç»˜åˆ¶ç´¢å¼•æ ‡ç­¾
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                for (let i = 0; i < n; i++) {
                    const x = startX + i * barWidth;
                    ctx.fillText(`i=${i}`, x + barWidth / 2, startY + 40);
                }
            }
        }

        function updateInfo() {
            if (currentStep < steps.length) {
                const step = steps[currentStep];
                document.getElementById('currentIndex').textContent = step.index;
                document.getElementById('currentHeight').textContent = step.height;
                document.getElementById('leftMax').textContent = step.leftMax;
                document.getElementById('rightMax').textContent = step.rightMax;
                document.getElementById('waterLevel').textContent = step.waterLevel;
                document.getElementById('waterAmount').textContent = step.waterAmount;
                
                // è®¡ç®—æ€»æ¥æ°´é‡
                totalWater = steps.slice(0, currentStep + 1).reduce((sum, s) => sum + s.waterAmount, 0);
                document.getElementById('totalWater').textContent = totalWater;
            }
        }

        function playPause() {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        }

        function play() {
            isPlaying = true;
            document.getElementById('playBtn').textContent = 'â¸ æš‚åœ';
            
            function animate() {
                if (!isPlaying) return;
                
                if (currentStep < steps.length - 1) {
                    currentStep++;
                    draw();
                    updateInfo();
                    animationTimer = setTimeout(animate, speed);
                } else {
                    pause();
                }
            }
            
            animate();
        }

        function pause() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = 'â–¶ æ’­æ”¾';
            if (animationTimer) {
                clearTimeout(animationTimer);
            }
        }

        function stepForward() {
            pause();
            if (currentStep < steps.length - 1) {
                currentStep++;
                draw();
                updateInfo();
            }
        }

        function reset() {
            pause();
            currentStep = 0;
            totalWater = 0;
            draw();
            updateInfo();
        }

        function updateSpeed() {
            speed = parseInt(document.getElementById('speedSlider').value);
            document.getElementById('speedValue').textContent = speed + 'ms';
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            initAnimation();
        };
    </script>
</body>
</html>
